FROM python:3.8-slim


ENV PYTHONUNBUFFERED=1
ARG APP_HOME /usr/src/app


COPY ./ $APP_HOME/
WORKDIR /$APP_HOME
#Installing system dependencies
RUN apt update && apt install --no-install-recommends -y wget libxtst6 fonts-liberation libappindicator3-1 libasound2 libatk-bridge2.0-0 \
    libnspr4 libnss3 lsb-release xdg-utils libxss1 libdbus-glib-1-2 bzip2 libgbm1 $BUILD_DEPS xvfb && \
    #Installing geckodriver
    wget -O "/opt/geckodriver-v0.31.0-linux64.tar.gz" "https://github.com/mozilla/geckodriver/releases/download/v0.31.0/geckodriver-v0.31.0-linux64.tar.gz" && \
    tar -zxf /opt/geckodriver-v0.31.0-linux64.tar.gz -C /opt/ && \
    ln -s /opt/geckodriver /usr/local/bin/geckodriver && \
    rm /opt/geckodriver-v0.31.0-linux64.tar.gz && \
    #Installing firefox
    wget -O "/opt/firefox.tar.bz2" "https://download.mozilla.org/?product=firefox-latest-ssl&os=linux64&lang=en-US" && \
    tar -xjf /opt/firefox.tar.bz2 -C /opt/ && \
    ln -s /opt/firefox/firefox /usr/bin/firefox && \
    rm /opt/firefox.tar.bz2 && \
    pip3 install -r requirements.txt && \
    rm -rf /var/lib/apt/lists/*


CMD ["python3", "weather.py"]
